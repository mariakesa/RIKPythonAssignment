{% extends "base.html" %}

{% block main %}
<div class="container">
    <h2>Osaühingu asutamine</h2>
    <form action="/osauhingu_asutamine/entry" method="POST" id="form">
        {{osauhingu_asutamise_vorm.csrf_token}}
        <div class="container">
            <div class="form-group">
                {{osauhingu_asutamise_vorm.osauhingu_nimi.label}}
                {{osauhingu_asutamise_vorm.osauhingu_nimi}}
            </div>
            <div class="form-group">
                {{osauhingu_asutamise_vorm.registrikood.label}}
                {{osauhingu_asutamise_vorm.registrikood}}
            </div>
            <div class="form-group">
                {{osauhingu_asutamise_vorm.asutamise_kuupaev.label}}
                {{osauhingu_asutamise_vorm.asutamise_kuupaev}}
            </div>
        </div>
        <div id="lisatud-fuus-asutajad">
            <h6>Füüsilisest isikust asutajad</h6>
        </div>
        <div id="lisatud-juur-asutajad">
            <h6>Juriidilisest isikust asutajad</h6>
        </div>
        <div class="form-group">
            {{osauhingu_asutamise_vorm.asuta}}
        </div>
    </form>
    <div> Lisa osanikud </div>
    <form action="/osauhingu_asutamine" method="post">
        {{otsing_dct['fuus_isikud_nimeline_otsing'].csrf_token}}
        {{otsing_dct['fuus_isikud_nimeline_otsing'].fuus_is_marksona.label}}
        <!--{{otsing_dct['fuus_isikud_nimeline_otsing'].fuus_is_marksona}}
        <!--{{otsing_dct['fuus_isikud_nimeline_otsing'].otsi}}-->
    </form>
    <input id="fuus_is_marksona" name="fuus_is_marksona" required type="text" value=""/>
    <button onclick="otsiOsanikuNime(document.getElementById('fuus_is_marksona').value)">Click me</button>
    <form action="/osauhingu_asutamine" method="post">
        {{otsing_dct['fuus_isikud_ik_otsing'].csrf_token}}
        {{otsing_dct['fuus_isikud_ik_otsing'].isikukood.label}}
        {{otsing_dct['fuus_isikud_ik_otsing'].isikukood}}
        {{otsing_dct['fuus_isikud_ik_otsing'].otsi}}
    </form>
    <!--
    <form action="/" method="post">
        {{otsing_dct['juur_isikud_nimeline_otsing'].csrf_token}}
        {{otsing_dct['juur_isikud_nimeline_otsing'].juur_is_marksona.label}}
        {{otsing_dct['juur_isikud_nimeline_otsing'].juur_is_marksona}}
        {{otsing_dct['juur_isikud_nimeline_otsing'].otsi}}
    </form>
    <form action="/" method="post">
        {{otsing_dct['juur_isikud_rk_otsing'].csrf_token}}
        {{otsing_dct['juur_isikud_rk_otsing'].juur_is_registrikood.label}}
        {{otsing_dct['juur_isikud_rk_otsing'].juur_is_registrikood}}
        {{otsing_dct['juur_isikud_rk_otsing'].otsi}}
    </form>
-->
    <div id="fuus-otsingu-tulemused">
        <table id="fuus-otsingu-tabel" class="table"></table>
    </div>
    <div id="juur-otsingu-tulemused">
        <table class="table">
            <thead>
                <tr>
                    {% for column in juur_paringu_tagastus.columns %}
                    <th>{{ column }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in juur_paringu_tagastus.values %}
                <tr>
                    {% for value in row %}
                    <td>{{ value }}</td>
                    {% endfor %}
                    <td><button>Click me</button></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!--
    <button type="button" id="lisa-fuus-button" onclick="addFuusAsutajaBox()">+</button>
    <button id="eemalda-fuus-button">-</button>
    <div id="fuus-asutajad">  
    </div>
    <div class="form-group">
        {{osauhingu_asutamise_vorm.asuta}}
    </div>-->
</div>
</div>
<div class="container" id="edu_sonum">
    {% if edu_sonum != None%}
        {{edu_sonum}}
    {% endif %}
</div>

<script>
    function wrapFormGroup(elem) {
        var formGroup = document.createElement("div");
        formGroup.className = "form-group";
        formGroup.appendChild(elem);
        return formGroup;
    }

    function addOsanikToForm(asutajaID,asutajaNimi) {

        //var osanik = JSON.parse(jsonStr);

        var numFuusAsutaja = document.querySelectorAll(".fuus-asutaja").length;

        //create a new box
        var box = document.createElement("div");
        box.className = "fuus-asutaja";

        var nimi = document.createElement("div");
        nimi.innerText=asutajaNimi;
        box.appendChild(nimi);

        var container = document.querySelector("#lisatud-fuus-asutajad");

        container.appendChild(box);

        console.log(nimi.innerText)

        var input = document.createElement("input");
        input.type = "int";
        input.name = "fuus_is_asutajad-" + numFuusAsutaja+'-fuus_is_asutaja_kapital';
        input.value=100
        box.appendChild(wrapFormGroup(input));

        var input = document.createElement("input");
        input.type = "hidden";
        input.name = "fuus_is_asutajad-" + numFuusAsutaja+'-fuus_is_asutaja_index';
        input.value =   asutajaID;
        box.appendChild(wrapFormGroup(input));


    }

    function otsiOsanikuNime(nimi) {
        const params = {
            nimi: nimi
        };
        const options = {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify( params )  
        };
        fetch( 'osaniku_otsing', options )
            .then( response => response.json() )
            .then( response => {
                console.log(response);
                let datatable = response["id"].map(function(id, i) {
                    return [id,response["Füüsilisest isikust osaniku nimi"][i],response['Isikukood'][i]];
                });
                $('#fuus-otsingu-tabel').DataTable({
                    data: datatable,
                    searching: false,
                    destroy: true,
                    columns: [
                    { title: "Nimi", data: 1 },
                    { title: "Isikukood", data: 2 }
                    ]
                });
            } );
        }
</script>
<!--
<script>

function wrapFormGroup(elem) {
  var formGroup = document.createElement("div");
  formGroup.className = "form-group";
  formGroup.appendChild(elem);
  return formGroup;
}
    function addFuusAsutajaBox() {
    // get the number of existing boxes
    var numBoxes = document.querySelectorAll(".fuus-asutaja-box").length;

    // create a new box
    var box = document.createElement("div");
    box.className = "fuus-asutaja-box";

    var label = document.createElement("label");
    label.innerHTML = "Asutaja";
    box.appendChild(wrapFormGroup(label));

    var input = document.createElement("input");
    input.type = "text";
    input.name = "fuus_is_asutajad-" + numBoxes+'-fuus_is_asutaja';
    box.appendChild(wrapFormGroup(input));

    var label2 = document.createElement("label");
    label2.innerHTML = "Asutaja isikukood";
    box.appendChild(warpFormGroup(label2));

    var input2 = document.createElement("input");
    input2.type = "text";
    input2.name = "fuus_is_asutajad-" + numBoxes+'-fuus_is_asutaja_ik';
    box.appendChild(wrapFormGroup(input2));

    // add the new box to the page
    var parent = document.getElementById("fuus-asutajad");
    parent.appendChild(box);
    }


    addFuusAsutajaBox();
</script>
-->
{%endblock%}